$query = '<QueryList><Query Id="0" Path="Microsoft-Windows-Sysmon/Operational"><Select Path="Microsoft-Windows-Sysmon/Operational">*[System[(EventID=11 or EventID=23) and TimeCreated[timediff(@SystemTime) &lt;= 300000]]] and *[EventData[Data[@Name="TargetFilename"] and Data="$HONEYFILE$"]]</Select></Query></QueryList>';
Get-WinEvent -FilterXML $($query)| ForEach {$eventXML = [xml]$_.toxml(); $info=$eventXML.Event.EventData.Data; $info| where-object Name  -like "ProcessId"} | ForEach {$_."#text"} | Select -Unique | ForEach {$PROCDUMP$ $_ -accepteula -mp "C:\$ARCHIVEDIR$\"; Stop-Process -Id $_ -Force;};
